function fish_prompt

  # gets the error status of the last command and 
  # updates the @ symbol color with the indication
  if test "$status" -ne "0"
    set ARROW "$ERROR"
  else
    set ARROW "$SUCCESS"
  end

  # trim everything to the right of the . in whostname
  if test -n "$SHOW_HOST" 
    set HOST_STRING (echo $hostname | cut -f1 -d".")
    # add a space at the end
    set HOST_STRING "$HOST_STRING "
  end 

  # interactive user name @ (with error indicator) host name part with underline, date/time in YYYY-mm-dd format UTC, path info, and branch info (when available)
  echo (set_color $USER_COLOR)(whoami)(set_color $ARROW)@(set_color $HOST_COLOR)(tput smul)(echo $HOST_STRING)(tput rmul)(set_color $DATE_COLOR)(date -u '+%Y-%m-%d %H:%M:%S') UTC (set_color $PATH_COLOR)(pretty_path)(set_color $GIT_COLOR)(get_branch)
  echo "\$ "
end

function get_branch
  # minus symbol if there are no changes detected to tracked files
  # /dev/null prevents nonsensical errors when you are on directories not tracked by git.
  if test (git status --untracked-files=no --porcelain 2> /dev/null | wc -l) -eq 0
    set indicator "-"
  else
    set indicator "+"
  end
  
  set branch_name (git rev-parse --abbrev-ref HEAD 2> /dev/null)
  if test "$branch_name" != ""
    echo "[$indicator]$branch_name"
  else
    echo ""
  end
end

function fish_greeting
  set_theme_colors
  if test (uname) = "Darwin"
    screenfetch
  else
    echo ""
    # I like neofetch a little better on Linux
    neofetch 
  end
end

function cal
  if test "$argv" = ""
    /usr/bin/cal | lolcat
  else
    /usr/bin/cal $argv | lolcat
  end
end

function pretty_path
  # by default, Fish shell does not print ~ for $HOME
  echo (pwd | sed "s|^$HOME|~|g")
end

function set_theme_colors
  set -gx ERROR CB0000
  set -gx SUCCESS 58A82F

  set FG_COLOR    bd8141
  set BG_COLOR    1e140a
  set BRIGHT_RED  cb4b16
  set CYAN        268bd2
  set YELLOW      b58900
  set ORANGE      FF9933

  if test "$FISH_THEME" = "gruvbox"
    set -gx USER_COLOR C46210
    set -gx HOST_COLOR 00CC00
    set -gx DATE_COLOR FF9933
    set -gx PATH_COLOR 268bd2
    set -gx GIT_COLOR  b58900
  else
    set USER_COLOR "3399FF"
    set HOST_COLOR "00CC00"
    set DATE_COLOR "FF9933"
    set PATH_COLOR "6B6FFF"
    set GIT_COLOR  "03A9F4"
  end
end

